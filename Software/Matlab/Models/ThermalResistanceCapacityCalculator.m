function [Rtot,Cs] = ThermalResistanceCapacityCalculator(nLayers,material,thick)

% UCtestML2 calculates wall resistance and active heat capacity for a given
% wall with number of layers "nLayers", materials layout defined in "material" 
% and thickness assigned in the vector "thick"  
% IMPORTANT: LAYERS ORDER
% The materials layout is crucial for the calculation of the heat capacity 
% Slab layers are ordered from outdoors to indoors space,i.e the
% first material in the vector is outside and the last is inside.
% Verified against data from Consolis

% clc
% clear
% 
% nLayers     = 3;
% material    = {'concrete','mineral wool', 'brick'};
% thick       = [0.2,0.1,0.2];

% material = input('insert material:  ','s');
for NoL = 1: nLayers
  
    if strcmp(material(1,NoL),'brick') == 1
            rho     = 1800;
            lambda  = 0.62;
            c       = 840;
    elseif strcmp(material(1,NoL), 'concrete') == 1
            rho     = 2300;
            lambda  = 1.7;
            c       = 880;
    elseif strcmp(material(1,NoL), 'aerated concrete') == 1
            rho     = 500;
            lambda  = 0.15;
            c       = 1050;
    elseif strcmp(material(1,NoL), 'mineral wool') == 1
            rho     = 30;
            lambda  = 0.036;
            c       = 1000;
    else warning('material not available');
    end

T       = 3600*24;          % period, 24h [s]
omega   = 2*pi/T;            % angular velocity,[s^(-1)]       
a       = lambda/(rho*c);
k       = sqrt(omega/(2*a)); % 

% A,B,C,D calculated for the single layer

A       = cosh(k*thick(1,NoL)*(1+1i));
B       = -(sinh(k*thick(1,NoL)*(1+1i)))/(lambda*k*(1+1i));
C       = -lambda*k*(1+1i)*sinh(k*thick(1,NoL)*(1+1i));
D       = cosh(k*thick(1,NoL)*(1+1i));

    if NoL == 1
        AA      = A;
        BB      = B;
        CC      = C;
        DD      = D;
    else
        AA  = A * AA_v(NoL-1) + B * CC_v(NoL-1);
        BB  = A * BB_v(NoL-1) + B * DD_v(NoL-1);
        CC  = C * AA_v(NoL-1) + D * CC_v(NoL-1) ; 
        DD  = C * BB_v(NoL-1) + D * DD_v(NoL-1);
    end
      
    RL      = thick(1,NoL)/lambda;

    A_v(NoL)  = A;
    B_v(NoL)  = B;
    C_v(NoL)  = C;
    D_v(NoL)  = D;
    
    AA_v(NoL) = AA;
    BB_v(NoL) = BB;
    CC_v(NoL) = CC;
    DD_v(NoL) = DD;
    
    R_v(NoL)  = RL;
    
end
    A_v;
    B_v;
    C_v;
    D_v;
    
    AA_v;
    BB_v;
    CC_v;
    DD_v;
    
    E       = DD_v(nLayers)/BB_v(nLayers);
    F       = CC_v(nLayers)-DD_v(nLayers)*AA_v(nLayers)/BB_v(nLayers);


Cs      = abs((E+F)/omega);  % Active heat capacity [J/m2K]

% Ra      = 0.17;
% Rtot	= sum(R_v) + Ra;	% Specific thermal resistance [K m2/W]
Rtot	= sum(R_v);
U       = 1/Rtot;			% Thermal conductivity [W/m2 K ]

Rwtest      = -real(1/(E+F));
Cwtest      = 1/((imag(1/(E+F)))*omega);


end