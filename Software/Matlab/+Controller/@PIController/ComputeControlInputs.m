% Compute the inputs over the prediction horizon
%
% ALGORITHM
% - 
%
function ComputeControlInputs( tController , tParameters )
	%
	%
	try %
		if( tController.bPrintDebugInformation )
			%
			fprintf('Entering ComputeControlInputs()\n');
			%
		end;%
		%
		%------------------------------------------------------------------
		%Initialization
		%
		TEMPERATURE_REFERENCE				= 21.5;
		KP									= 100;
		tDevicesIDs							= Signal.GetDevicesIDs();
		tSignalsIDs							= Signal.GetSignalsIDs();
		%
		%index research
		iTemperatureOfTheRoomIndex	= Signal.FindSignalIndex(	tController.atMeasurementsSignals ,						...
																tSignalsIDs.iTemperatureOfEnvironment ,					...
																tDevicesIDs.iMote1035);
		iFreshAirInletValveIndex	= Signal.FindSignalIndex(	tController.atActuationsSignals ,						...
																tSignalsIDs.iFreshAirInletValveOpeningPercentage ,		...
																tDevicesIDs.iPLC_A225);
		iExhaustAirValveOutletIndex	= Signal.FindSignalIndex(	tController.atActuationsSignals ,						...
																tSignalsIDs.iExhaustAirOutletValveOpeningPercentage ,	...
																tDevicesIDs.iPLC_A225);
		iACValveIndex				= Signal.FindSignalIndex(	tController.atActuationsSignals ,						...
																tSignalsIDs.iACValveOpeningPercentage ,					...
																tDevicesIDs.iPLC_A225);
		iRadiatorValveIndex			= Signal.FindSignalIndex(	tController.atActuationsSignals ,						...
																tSignalsIDs.iRadiatorValveOpeningPercentage ,					...
																tDevicesIDs.iPLC_A225);
		%
		%
		% -----------------------------------------------------------------
		% Computation of the commands
		%
		fTemperatureOfTheRoom		= tController.atMeasurementsSignals(iTemperatureOfTheRoomIndex).ExtractSamplesAt(Time.GetCurrentJulianDate());
		fTemperatureError			= TEMPERATURE_REFERENCE -	fTemperatureOfTheRoom;
		fActuationCommand			= fTemperatureError * KP;
		%
		if ( fActuationCommand >= 0 )
			%
			if ( fActuationCommand > tParameters.tActuationBounds.fUpperBound ) 
				%
				fActuationCommand = tParameters.tActuationBounds.fUpperBound;
				%
			end;% end putting bounds to the actuation command
			%
			tController.atActuationsSignals(iFreshAirInletValveIndex).Insert(		fActuationCommand,	Time.GetCurrentJulianDate(), true )
			tController.atActuationsSignals(iExhaustAirValveOutletIndex).Insert(	fActuationCommand,	Time.GetCurrentJulianDate(), true )
			tController.atActuationsSignals(iACValveIndex).Insert(					0,					Time.GetCurrentJulianDate(), true );
			tController.atActuationsSignals(iRadiatorValveIndex).Insert(			0,					Time.GetCurrentJulianDate(), true );
			%
		else%
			%
			if ( fActuationCommand < - tParameters.tActuationBounds.fUpperBound ) 
				%
				fActuationCommand = -tParameters.tActuationBounds.fUpperBound;
				%
			end;% end putting bounds to the actuation command
			%
			tController.atActuationsSignals(iFreshAirInletValveIndex).Insert(		0,					Time.GetCurrentJulianDate(), true )
			tController.atActuationsSignals(iExhaustAirValveOutletIndex).Insert(	0,					Time.GetCurrentJulianDate(), true )
			tController.atActuationsSignals(iACValveIndex).Insert(					-fActuationCommand,	Time.GetCurrentJulianDate(), true );
			tController.atActuationsSignals(iRadiatorValveIndex).Insert(			0,					Time.GetCurrentJulianDate(), true );
			%
		end;% end calculation of the Actuation Commands
		%
		%------------------------------------------------------------------
		%
		if( tController.bPrintDebugInformation )
			%
			fprintf('Exiting ComputeControlInputs()\n');
			%
		end;%
		%
	catch exception
		%
		disp(exception.message);
		warning( strcat('Error in ComputeControlInputs for  ', tController.strControllerID) );
		%
	end;% catch
	%
end % function

