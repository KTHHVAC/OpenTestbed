% Compute the inputs over the prediction horizon
%
% ALGORITHM
% - 
%
function ComputeControlInputsRadiator( tController )
	%
	%
	try %
		if( tController.bPrintDebugInformation )
			%
			fprintf('Entering ComputeControlInputsRadiator()\n');
			%
		end;%
		%
		%------------------------------------------------------------------
		% initialization
		TEMPERATURE_REFERENCE				= tController.fTemperatureReference;
		fPIConstantA = 6.925;
		fPIConstantB = -2.417;
		%
		tDevicesIDs							= Signal.GetDevicesIDs();
		tSignalsIDs							= Signal.GetSignalsIDs();
		fCurrentJulianDate					= Time.GetCurrentJulianDate();
		%
		%------------------------------------------------------------------
		%index research
		aiSurfaceTemperatureOfRadiatorIndex			= [Signal.FindSignalIndex(	tController.atMeasurementsSignals ,			...
																tSignalsIDs.iSurfaceTemperatureOfRadiator ,			...
																tDevicesIDs.iMote1045);								...
											   Signal.FindSignalIndex(	tController.atMeasurementsSignals ,			...
																tSignalsIDs.iSurfaceTemperatureOfRadiator ,			...
																tDevicesIDs.iMote1052);								...
											   Signal.FindSignalIndex(	tController.atMeasurementsSignals ,			...
																tSignalsIDs.iSurfaceTemperatureOfRadiator ,			...
																tDevicesIDs.iMote1053);								...
											   Signal.FindSignalIndex(	tController.atMeasurementsSignals ,			...
																tSignalsIDs.iSurfaceTemperatureOfRadiator ,			...
																tDevicesIDs.iMote1054)];
		iRadiatorValveIndex					= Signal.FindSignalIndex(	tController.atActuationsSignals ,			...
																tSignalsIDs.iRadiatorValveOpeningPercentage ,		...
																tDevicesIDs.iPLC_A225);
															
		iFreshAirInletValveIndex			= Signal.FindSignalIndex(	tController.atActuationsSignals ,				...
																tSignalsIDs.iFreshAirInletValveOpeningPercentage ,		...
																tDevicesIDs.iPLC_A225);
		iExhaustAirValveOutletIndex			= Signal.FindSignalIndex(	tController.atActuationsSignals ,				...
																tSignalsIDs.iExhaustAirOutletValveOpeningPercentage ,	...
																tDevicesIDs.iPLC_A225);
		iACValveIndex						= Signal.FindSignalIndex(	tController.atActuationsSignals ,				...
																tSignalsIDs.iACValveOpeningPercentage ,					...
																tDevicesIDs.iPLC_A225);
		%
		% -----------------------------------------------------------------
		% Computation of the commands
		%
		aafSurfaceTemperatureOfRadiator				= tController.atMeasurementsSignals(aiSurfaceTemperatureOfRadiatorIndex);
		afSurfaceTemperatureOfRadiator				= zeros(1,length(aiSurfaceTemperatureOfRadiatorIndex));
		
		for ii =1:length(aiSurfaceTemperatureOfRadiatorIndex)
			 temp = aafSurfaceTemperatureOfRadiator(ii).afValues;
			 afSurfaceTemperatureOfRadiator(ii) = temp(end);
		end
		
		fActuationCommand					= tController.radiator_control(	afSurfaceTemperatureOfRadiator,			...
																			TEMPERATURE_REFERENCE,						...
																			fPIConstantA,								...
																			fPIConstantB );
		%
		%--------------------------------------------------------------------------------------------------------------
		%
% 		if ( fActuationCommand > tController.tInputsBounds.fUpperBound )
% 			%
% 			fActuationCommand = tController.tInputsBounds.fUpperBound;
% 			%
% 		elseif ( fActuationCommand < tController.tInputsBounds.fLowerBound )
% 			%
% 			fActuationCommand = tController.tInputsBounds.fLowerBound;
% 			%
% 		end;% end bounding the input command
% 		%
% 		%
		if ( tController.bUseRadiators )
			%
			tController.atActuationsSignals(iRadiatorValveIndex).Insert( fActuationCommand,	fCurrentJulianDate, true );
			
			% just the radiators are working
			tController.atActuationsSignals(iFreshAirInletValveIndex).Insert(	 0,	fCurrentJulianDate, true );
			tController.atActuationsSignals(iExhaustAirValveOutletIndex).Insert( 0,	fCurrentJulianDate, true );
			tController.atActuationsSignals(iACValveIndex).Insert(				 0,	fCurrentJulianDate, true );
			%
		else
			%
			tController.atActuationsSignals(iRadiatorValveIndex).Insert( 0,	fCurrentJulianDate, true );
			
			% just the radiators are working
			tController.atActuationsSignals(iFreshAirInletValveIndex).Insert(	 0,	fCurrentJulianDate, true );
			tController.atActuationsSignals(iExhaustAirValveOutletIndex).Insert( 0,	fCurrentJulianDate, true );
			tController.atActuationsSignals(iACValveIndex).Insert(				 0,	fCurrentJulianDate, true );
			%
		end;%
		%
		%
		if( tController.bPrintDebugInformation )
			%
			fprintf('\nActuation percentage calculated >>>> %3.1f \n',	fActuationCommand);
			%
		end;% end print debug information on the PI values
		%
		%------------------------------------------------------------------
		%
		if( tController.bPrintDebugInformation )
			%
			fprintf('Exiting ComputeControlInputsRadiator()\n');
			%
		end;%
		%
	catch exception
		%
		disp(exception.message);
		warning( strcat('Error in ComputeControlInputsRadiator for  ', tController.strControllerID) );
		%
	end;% catch
	%
end % function

