% Prepare  cost matrices over the prediction orizon for deterministic MPC.
%
% function BuildConstraintsEvolutionMatrices( tController, afActuationBounds, afComfortBounds, iPredictionHorizon )
%
% the afActuationBounds and afComfortBounds must be passed like colums
% for instance like
% tController.tActuationBounds.afActuationLowerBounds = [				...
% 				tController.tActuationBounds.Ventilation.fLowerBound	...
% 				tController.tActuationBounds.Radiator.fLowerBound		...
% 				tController.tActuationBounds.Cooling.fLowerBound		]';
% tController.tActuationBounds.afActuationUpperBounds = [				...
% 				tController.tActuationBounds.Ventilation.fUpperBound	...
% 				tController.tActuationBounds.Radiator.fUpperBound		...
% 				tController.tActuationBounds.Cooling.fUpperBound		]';
%
% ==>> [	tDebugController.tActuationBounds.afActuationLowerBounds;	...
% 			tDebugController.tActuationBounds.afActuationUpperBounds	]
%
function [aafGu, aafGy, afBu, afBy, aafGGu, aafGGy, afBBu, afBBy] =		...
				BuildConstraintsEvolutionMatrices(	tController,		...
													afInputsBounds,		...
													afOutputsBounds,	...
													iPredictionHorizon	)
	%
	try %
		% get the number of inputs and outputs
		%
		iNumberOfInputs		= size( tController.tModel.aafB, 2 );
		iNumberOfOutputs	= size( tController.tModel.aafC, 1 );
		%
		%------------------------------------------------------------------
		% build the constraint vector for one step
		%
		aafGu	= [ -	eye( iNumberOfInputs )	;	...
						eye( iNumberOfInputs )	];
		aafGy	= [ -	eye( iNumberOfOutputs ) ;	...
						eye( iNumberOfOutputs ) ];
		afBu	= vertcat( -	afInputsBounds	(1	:     iNumberOfInputs	),						...
								afInputsBounds	(iNumberOfInputs  + 1	: 2 * iNumberOfInputs	)	);
		afBy	= vertcat( -	afOutputsBounds	(1						:     iNumberOfOutputs	),	...
								afOutputsBounds	(iNumberOfOutputs + 1	: 2 * iNumberOfOutputs	)	);
		%
		%------------------------------------------------------------------
		% build the constraint matrices over the whole horizon
		%
		aafGGu	= kron( eye( iPredictionHorizon ), aafGu );
		aafGGy	= kron( eye( iPredictionHorizon ), aafGy );
		%
		afBBu	= repmat( afBu , iPredictionHorizon , 1);
		afBBy	= repmat( afBy , iPredictionHorizon , 1);
		%
		%
	catch exception
		%
		disp(exception.message)
		warning('Problems building the cost evolution matrices')
		%
	end;% end catch
	%
end % end function


