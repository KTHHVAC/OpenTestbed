% function tParameters = SetParameters( tController )
%
function Postprocessing( tController )
	%
	try %
		%
		%retriving the needed indexes
		tDevicesIDs							= Signal.GetDevicesIDs();
		tSignalsIDs							= Signal.GetSignalsIDs();
		%
		iAmountOfFreshAirNeededIndex	=								...
				Signal.FindSignalIndex(									...
							tController.atStatesSignals,				...
							tSignalsIDs.iAmountOfFreshAirNeeded,		...
							tDevicesIDs.iCO2MPCController				);
		
		iLowerBoundOfFreshAirNeededIndex	=							...
				Signal.FindSignalIndex(									...
							tController.atStatesSignals,				...
							tSignalsIDs.iLowerBoundOfFreshAirNeeded,	...
							tDevicesIDs.iCO2MPCController				);
		%
		%
		fCurrentJulianDate = Time.GetCurrentJulianDate();
		%
		tController.atStatesSignals(iAmountOfFreshAirNeededIndex).Insert( tController.afOptimizationProblemSolution(1), fCurrentJulianDate, true );
		%
		afInputOptimizationProblemSolution = tController.afOptimizationProblemSolution(1:tController.iPredictionHorizon);
		afStatesOverPredictionHorizon =		tController.tModel.aafAA * tController.tModel.afX0				...
										+	tController.tModel.aafAB * afInputOptimizationProblemSolution	...
										+	tController.tModel.aafAE * tController.tModel.afWW;
		%
		%allocating space
		tController.afRequestedMassFlowOverPredictionHorizon	=		zeros(tController.iPredictionHorizon, 1);
		%
		tController.afRequestedMassFlowOverPredictionHorizon(1)	=		tController.afOptimizationProblemSolution(1) ...
																	/	tController.tModel.afX0;
		%
		% sottrazione
		for iTimeStep = 2 : tController.iPredictionHorizon
			%
			tController.afRequestedMassFlowOverPredictionHorizon(iTimeStep)	=		...	
							tController.afOptimizationProblemSolution(iTimeStep)	...
							/	afStatesOverPredictionHorizon(iTimeStep - 1);
			%
		end;% end for
		%
		%
		for iTimeStep = 1 : numel(tController.afRequestedMassFlowOverPredictionHorizon)
			%
			if (		tController.afRequestedMassFlowOverPredictionHorizon(iTimeStep)		...
					>	tController.Controller.tInputsBounds.AirMassFlow.fUpperBound 		)
				%
						tController.afRequestedMassFlowOverPredictionHorizon(iTimeStep)		...
					=	tController.Controller.tInputsBounds.AirMassFlow.fUpperBound		;
				%
			elseif (	tController.afRequestedMassFlowOverPredictionHorizon(iTimeStep)		...
					<	tController.Controller.tInputsBounds.AirMassFlow.fLowerBound 		)
				%
						tController.afRequestedMassFlowOverPredictionHorizon(iTimeStep)		...
					=	tController.Controller.tInputsBounds.AirMassFlow.fLowerBound		;
				%
			end%;
			%
		end;%
		%
		tController.atStatesSignals(iLowerBoundOfFreshAirNeededIndex).Insert( tController.afRequestedMassFlowOverPredictionHorizon(1) , fCurrentJulianDate, true )
		%
		%
	catch exception
		%
		disp(exception.message);
		warning('Problems setting in the post processing phase.');
		%
	end;% end catch
	%
end % end function