%% Energy Computation

fRhoSoftConstraintsWeight	=	tTemperatureController.afRhoSoftConstraintsWeight;
fTemperatureUpperBound		=	20;	
fTemperatureLowerBound		=	22;
afLinearCostMatrix			=	tTemperatureController.afLinearCostFunctionMatrix(:,:,1);


fInputsEnergyImplicit = sum(afLinearCostMatrix * afInputsMatrixImplicit);
fInputsEnergyExplicit = sum(afLinearCostMatrix * afInputsMatrixExplicit);

afViolationImplicit = zeros(1, tTemperatureController.iPredictionHorizon); 
afViolationExplicit = zeros(1, tTemperatureController.iPredictionHorizon); 

for iTimeStep = 1:tTemperatureController.iPredictionHorizon
	%
	if afOutputVectorImplicit(iTimeStep)< fTemperatureLowerBound
		%
		%
		afViolationImplicit(iTimeStep) = ( fTemperatureLowerBound -  afOutputVectorImplicit(iTimeStep) );
		%
	elseif afOutputVectorImplicit(iTimeStep)> fTemperatureUpperBound
		%
		afViolationImplicit(iTimeStep) = ( afOutputVectorImplicit(iTimeStep)	-	fTemperatureUpperBound);
		%
	else
		afViolationImplicit(iTimeStep) = 0;
		%
	end;%		
end;%

for iTimeStep = 1:tTemperatureController.iPredictionHorizon
	%
	if afOutputVectorExplicit(iTimeStep)< fTemperatureLowerBound
		%
		%
		afViolationExplicit(iTimeStep) = ( fTemperatureLowerBound -  afOutputVectorExplicit(iTimeStep) );
		%
	elseif afOutputVectorExplicit(iTimeStep)> fTemperatureUpperBound
		%
		afViolationExplicit(iTimeStep) = ( afOutputVectorExplicit(iTimeStep)	-	fTemperatureUpperBound);
		%
	else
		afViolationExplicit(iTimeStep) = 0;
		%
	end;%		
end;%
	
fViolationEnergyImplicit = sum(afViolationImplicit)*fRhoSoftConstraintsWeight;
fViolationEnergyExplicit = sum(afViolationExplicit)*fRhoSoftConstraintsWeight;

fTotalEnergyImplicit		= fInputsEnergyImplicit + fViolationEnergyImplicit;
fTotalEnergyExplicit		= fInputsEnergyImplicit + fViolationEnergyExplicit;
afEnergy = [	fTotalEnergyImplicit, fTotalEnergyExplicit;			...
				fViolationEnergyImplicit, fViolationEnergyExplicit;	...
				fInputsEnergyImplicit, fInputsEnergyExplicit];		
figure(3);
 bar(afEnergy,'grouped'); title('Group')
 set(gca,'xTickLabel',{'TotalEnergy','ViolationEnergy','InputsEnergy'});
 legend('Implicito','Esplicito')
	