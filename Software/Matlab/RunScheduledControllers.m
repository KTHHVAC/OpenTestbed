% locked out from the system
if( any( strcmp( who, 'tTCPConnection' ) ) )
	%
	fclose( tTCPConnection.tTcpIpClient );
	%
end;%
%
%
close all;
clear all;
clear classes;
clc;
 
% to get the updated models
addpath(genpath('Models/'));

% to get CPLEX path
% addpath(genpath('/Users/giorgiopattarello/Applications/IBM/ILOG/CPLEX_Studio1251/cplex/')) %????????
% addpath(genpath('C:/Program Files/IBM/ILOG/CPLEX_Studio125/cplex'));

% import the necessary classes
import EstimationAlgorithms.*;
import Controller.*;
import MatlabToTikZ.*;
import InternetConnection.*;
import Scenarios.*;



% allocate the TCP connection object
tTCPConnectionParameters			= InternetConnection.LoadDefaultTCPConnectionParameters();
tTCPConnection						= InternetConnection.KTHConnection( tTCPConnectionParameters );

% do the first allocation of the controllers
global tCO2Controller;
tCO2Controller = [];
global tCO2Controller;
tCO2Controller = [];
global tCO2Controller;
tCO2Controller = [];
global tCO2Controller;
tCO2Controller = [];
global tCO2Controller;
tCO2Controller = [];
global tCO2Controller;
tCO2Controller = [];



tClockManager.tMainTimer =																					...
	timer(																									...
		'TimerFcn',			{@ClockManager.CheckForChanges,		{ atControllers }		  tPIController, tTCPConnection },	...
		'ErrorFcn',			{@ClockManager.OnError,				{ atControllers } },						...
		'StartFcn',			{@ClockManager.OnStart,				{ atControllers } },						...
		'StopFcn',			{@ClockManager.OnExit,				{ atControllers } },						...
		'Period',			60 * 60,																		...
		'ExecutionMode',	'fixedRate',																	...
		'BusyMode',			'drop'																			);


tClockManager.atControllersTimers{1} =																...
	timer(																							...
		'TimerFcn',			{@Controller.RunPI,				  tPIController, tTCPConnection },		...
		'ErrorFcn',			{@Controller.OnError,			{ tPIController } },					...
		'StartFcn',			{@Controller.OnStart,			{ tPIController } },					...
		'StopFcn',			{@Controller.OnExitNoTCPClose,	{ tPIController } },					...
		'Period',			tPIController.fSamplingTimeInSeconds,									...
		'TasksToExecute',	tPIController.iNumberOfRunsToBeExecuted,								...
		'ExecutionMode',	'fixedRate',															...
		'BusyMode',			'drop'																	);


