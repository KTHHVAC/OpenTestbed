% locked out from the system
if( any( strcmp( who, 'tTCPConnection' ) ) )
	%
	fclose( tTCPConnection.tTcpIpClient );
	%
end;%
%
%
close all;
clear all;
clear classes;
clc;
 
% to get the updated models
addpath(genpath('Models/'));

% to get the necessary IPWA functions (for Explicit MPC)
addpath(genpath('Comparisons'));

% to get CPLEX path
addpath(genpath('C:/Program Files/IBM/ILOG/CPLEX_Studio125/cplex'));

% import the necessary classes
import EstimationAlgorithms.*;
import Controller.*;
import MatlabToTikZ.*;
import InternetConnection.*;
import Scenarios.*;

% allocate the TCP connection object
global tTCPConnection;
tTCPConnectionParameters	= InternetConnection.LoadDefaultTCPConnectionParameters();
tTCPConnection				= InternetConnection.KTHConnection( tTCPConnectionParameters );

% which room(s) to control
global strRoom;
% strRoom = 'A225';
% strRoom = 'A235';
strRoom = 'A225A235';

% do the first allocation of the controllers
global tCO2Controller;
tCO2Controller								= [];
global tCO2ControllerRoomA235;
tCO2ControllerRoomA235						= [];

global tTemperatureController;
tTemperatureController						= [];
global tTemperatureControllerRoomA235;
tTemperatureControllerRoomA235				= [];

global tAirConditionedPIController;
tAirConditionedPIController					= [];
global tAirConditionedPIControllerRoomA235;
tAirConditionedPIControllerRoomA235			= [];

strPathScheduledController	= 'ExampleOfControllerSchedule.txt';

global tClockManager;
tClockManager = ClockManager( strPathScheduledController );

tClockManager.tMainTimer =													...
	timer(																	...
		'TimerFcn',			{ @ClockManager.ManageTheRunningController },	...
		'ErrorFcn',			{ @ClockManager.OnError },						...
		'StartFcn',			{ @ClockManager.OnStart },						...
		'StopFcn',			{ @ClockManager.OnExit },						...
		'Period',			15 * 60,										...
		'ExecutionMode',	'fixedRate',									...
		'BusyMode',			'drop'											);
	
start( tClockManager.tMainTimer );

%% Saves the results

% delete(tClockManager.tMainTimer);delete(tClockManager.atControllerTimers{1});delete(tClockManager.atControllerTimers{2});delete(tClockManager.atControllerTimers{3});delete(tClockManager.atControllerTimers{4});


%% To set the actuation values to zero again

% tTCPConnection.SendToServer( 61, 2002, 'LB201_A225', 0 );
% tTCPConnection.SendToServer( 62, 2002, 'LB201_A225', 0 );
% tTCPConnection.SendToServer( 63, 2002, 'LB201_A225', 0 );
% tTCPConnection.SendToServer( 65, 2002, 'LB201_A225', 0 );
% 
% tTCPConnection.SendToServer( 61, 2003, 'LB201_A235', 0 );
% tTCPConnection.SendToServer( 62, 2003, 'LB201_A235', 0 );
% tTCPConnection.SendToServer( 63, 2003, 'LB201_A235', 0 );
% tTCPConnection.SendToServer( 65, 2003, 'LB201_A235', 0 );



