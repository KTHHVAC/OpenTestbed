function [ atOccupancyEvents, iEndingTime ] = TransformRawDataIntoEvents( aafRawData, iStartingTime )
	%
	global bPrintDebugInformation;
	%
	% DEBUG
	if( bPrintDebugInformation )
		fprintf('Transforming raw data into events\n');
	end;%
	%
	%
	if( nargin == 1 )
		%
		iStartingTime = 0;
		%
	end;%
	% 
	% sort the old data
	aafRawData = Occupancy.SortData( aafRawData );
	% 
	% delete the old data
	aafRawData = Occupancy.RemoveOldData( aafRawData, iStartingTime );
	% 
	% remove the redundant data (e.g., if there is some repeated key)
	aafRawData = Occupancy.RemoveRedundantData( aafRawData );
	%
	% if the process of removing data has eliminated everything, then
	% return immediately
	if( numel( aafRawData ) == 0 )
		%
		atOccupancyEvents	= [];
		iEndingTime			= iStartingTime;
		return;
		%
	end;%
	% 
	% segmentate the list of raw data events
	[	aiTimesOfBeginningsOfOccupancyEvents,			...
		aiTimesOfEndingsOfOccupancyEvents		]	=	...
			Occupancy.SegmentOccupancyEvents( aafRawData );
	%
	% for readability
	iNumberOfEvents = numel( aiTimesOfBeginningsOfOccupancyEvents );
	%
	% 
	% provide events only if one found them
	if( numel(aiTimesOfEndingsOfOccupancyEvents) > 0 )
		%
		% storage allocation
		atOccupancyEvents(iNumberOfEvents)	= Occupancy.OccupancyEvent();
		iEndingTime							= aiTimesOfEndingsOfOccupancyEvents(end);
		%
		for iEvent = 1:numel( aiTimesOfBeginningsOfOccupancyEvents )
			%
			% DEBUG
			if( bPrintDebugInformation )
			fprintf('Processing occupancy event %d\n', iEvent);
			end;%
			%
			iStartingIndex	= find( aafRawData(:, 2) == aiTimesOfBeginningsOfOccupancyEvents( iEvent ), 1, 'first' );
			iEndingIndex	= find( aafRawData(:, 2) == aiTimesOfEndingsOfOccupancyEvents( iEvent ), 1, 'last' );
			%
			atOccupancyEvents(iEvent) = Occupancy.OccupancyEvent( aafRawData(iStartingIndex:iEndingIndex, :) ); 
			%
			% DEBUG
			if( bPrintDebugInformation )
			atOccupancyEvents(iEvent).Plot();
			end;%			
			%
		end;% cycle on the various events
		% 
	else%
		%
		atOccupancyEvents	= [];
		iEndingTime			= [];
		%
		% DEBUG
		if( bPrintDebugInformation )
		fprintf('No events were found!\n');
		end;%			
		%		
	end;%
	%
	% remove the invalid events
	atOccupancyEvents = Occupancy.DiscardInvalidEvents( atOccupancyEvents );
	%
	% DEBUG
	if( bPrintDebugInformation )
	fprintf('Ended transforming raw data into events\n');
	end;%			
	%
end % function

