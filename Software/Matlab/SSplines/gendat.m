% gendat  Generates a training and test set given the linear model den(q)y(t) = numG(q)u(t) + numH(q)e(t) with one output 
% [y,U,ytestTot,ytest,Utest]=gendat(den,numG,numH,inp,inp2,ou,oe,n,nt,lowpar,lowpar2);
% 
% Outputs:
% y: output data in the training set
% U: inputs in the training set
% ytest_tot: output data in the test set
% ytest: last nt samples of ytest_tot
% Utest: inputs in the test set
%
% Inputs:
% den: row vector containing the coefficients defining the polynomial den(q)
% numG: matrix whose m rows containing the coefficients defining the m polynomials numG(q)
% numH: row vector containing the coefficients defining the polynomial numH(q)
% inp: statistics of the input that generates the training set 1-WN, 2-LP
% inp2: statistics of the input that generates the test set 1-WN, 2-LP
% ou: variance of the input if modeled as WN
% oe: variance of the innovation
% n: size of training set 
% nt: dimension of test set (number of elements in ytest)
% lowpar: upper limit of the passband relative to the input used to
%         generate the training set when inp=2 (thus always a number between 0 and 1)
% lowpar: upper limit of the passband relative to the input used to
%         generate the test set when inp2=2 (thus always a number between 0 and 1)

    
function  [y,U,ytestTot,ytest,Utest]=gendat(den,numG,numH,inp,inp2,ou,oe,n,nt,lowpar,lowpar2);

warning off
p2=400;%number of data removed for handling initial conditions effects,
       %the # of components of ytestTot will be p2+nt 
nn=n+p2;
m=size(numG,1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%ARMAX%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
np=max(size(numH))-1;
for kk=1:m;
    Gkk=dimpulse(numG(kk,:),den,nn);
    G(:,:,kk)=toeplitz(Gkk,zeros(1,nn));
    gtrue(:,kk)=G(:,1,kk);
end
H=dimpulse(numH,den,nn);
H=toeplitz(H,zeros(1,nn));
htrue=H(:,1);
ou=1;
oe=1;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%DATA%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
if inp==1;
    for kk=1:m;
        U(:,kk)=ou*randn(nn,1);
    end
else
    for kk=1:m;
        U(:,kk)=idinput(nn,'rgs',[0 lowpar]);
    end
end
E=oe*randn(nn,1);
y=H*E;
for kk=1:m;
    y=y+G(:,:,kk)*U(:,kk);
end
y=y((p2+1):nn);
U=U((p2+1):nn,:);
%figure(1);plot(y,'ko--');pause(2);%close all
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%TEST SET%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
ntest=nt+p2;
for kk=1:m;
    Gkk=dimpulse(numG(kk,:),den,ntest);
    Gkk=toeplitz(Gkk,zeros(1,ntest));
    Gtest(:,:,kk)=toeplitz(Gkk,zeros(1,ntest));
    if inp2==1;
        Utest(:,kk)=ou*randn(ntest,1);
    elseif inp2==2;
        Utest(:,kk)=idinput(ntest,'rgs',[0 lowpar2]);
    end
end
Htest=dimpulse(numH,den,ntest);
Htest=toeplitz(Htest,zeros(1,ntest));
Etest=oe*randn(ntest,1);
ytest=Htest*Etest;
for kk=1:m;
    ytest=ytest+Gtest(:,:,kk)*Utest(:,kk);
end
ytestTot=ytest;
ytest=ytest((p2+1):(p2+nt));
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    