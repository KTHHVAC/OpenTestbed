% locked out from the system
if( any( strcmp( who, 'tTCPConnection' ) ) )
	%
	fclose( tTCPConnection.tTcpIpClient );
	%
end;%

close all;
clear all;
clear classes;
clc;
 
% to get the updated models
addpath(genpath('Models/'));

% % to get CPLEX path
addpath(genpath('/Users/giorgiopattarello/Applications/IBM/ILOG/CPLEX_Studio1251/cplex/'))
% addpath(genpath('C:/Program Files/IBM/ILOG/CPLEX_Studio125/cplex'));

% import the necessary classes
import Controller.*;
import MatlabToTikZ.*;
import InternetConnection.*;
import Scenarios.*;
%
%
% %connection
tTCPConnectionParameters			= InternetConnection.LoadDefaultTCPConnectionParameters();
tTCPConnection						= InternetConnection.KTHConnection( tTCPConnectionParameters );
% %
% %
% % co2 controller
tCO2ControllerParameters			= Controller.LoadDeterministicCO2MPCParameters();
tTemperatureControllerParameters	= Controller.LoadDeterministicTemperatureMPCParameters();
% %
% %
%
%
TODO: implement the OnError() OnStart() etc.....
%
%
tCO2Controller						= Controller.DeterministicCO2MPC( tCO2ControllerParameters );
tTemperatureController				= Controller.DeterministicTemperatureMPC( tTemperatureControllerParameters );
%
%
tControllerDebugTimer = timer(																				...
	'TimerFcn',			{@Controller.RunDeterministicMPC, tCO2Controller, tTemperatureController , tTCPConnection },	...
	'ErrorFcn',			{@Controller.OnError,			tPIController},													...
	'StartFcn',			{@Controller.OnStart,			tPIController},													...
	'StopFcn',			{@Controller.OnExitNoTCPClose,	tPIController},													...
	'Period',			tCO2Controller.fSamplingTimeInSeconds,															...
	'TasksToExecute',	tCO2Controller.iNumberOfRunsToBeExecuted,														...
	'ExecutionMode',	'fixedRate',																					...
	'BusyMode',			'drop'														);
% 
start( tControllerDebugTimer );
disp('ControlTimer Started');


% %
% % fclose( tTCPConnection.tTcpIpClient );
% % %
% % %always delete timers before exiting!
% % %
% % delete(tControllerDebugTimer);






